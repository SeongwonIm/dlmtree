<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit tree structured distributed lag models — dlmtree • dlmtree</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit tree structured distributed lag models — dlmtree"><meta name="description" content="The 'dlmtree' function accommodates various response variable types, including continuous, binary, and zero-inflated count values.
The function is designed to handle both single exposure and exposure mixtures. For a single exposure, users are offered options to model non-linear effects (tdlnm),
linear effects (tdlm), or heterogeneous subgroup/individualized effects (hdlm). In the case of exposure mixtures, the function supports
lagged interactions (tdlmm), and heterogeneous subgroup/individualized effects (hdlmm) allowing for a comprehensive exploration of mixture exposure heterogeneity.
Additionally, users can fine-tune parameters to impose effect shrinkage and perform exposure selection, enhancing the adaptability and precision of the modeling process.
For more detailed documentation, visit: dlmtree website."><meta property="og:description" content="The 'dlmtree' function accommodates various response variable types, including continuous, binary, and zero-inflated count values.
The function is designed to handle both single exposure and exposure mixtures. For a single exposure, users are offered options to model non-linear effects (tdlnm),
linear effects (tdlm), or heterogeneous subgroup/individualized effects (hdlm). In the case of exposure mixtures, the function supports
lagged interactions (tdlmm), and heterogeneous subgroup/individualized effects (hdlmm) allowing for a comprehensive exploration of mixture exposure heterogeneity.
Additionally, users can fine-tune parameters to impose effect shrinkage and perform exposure selection, enhancing the adaptability and precision of the modeling process.
For more detailed documentation, visit: dlmtree website."><meta property="og:image" content="https://danielmork.github.io/dlmtree/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dlmtree</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-treed-dlm" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Treed DLM</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-treed-dlm"><li><a class="dropdown-item" href="../articles/TDLM.html">TDLM</a></li>
    <li><a class="dropdown-item" href="../articles/TDLNM.html">TDLNM</a></li>
    <li><a class="dropdown-item" href="../articles/TDLMM.html">TDLMM</a></li>
    <li><a class="dropdown-item" href="../articles/HDLM.html">HDLM</a></li>
    <li><a class="dropdown-item" href="../articles/HDLMM.html">HDLMM</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/danielmork/dlmtree/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fit tree structured distributed lag models</h1>
      <small class="dont-index">Source: <a href="https://github.com/danielmork/dlmtree/blob/master/R/dlmtree.R" class="external-link"><code>R/dlmtree.R</code></a></small>
      <div class="d-none name"><code>dlmtree.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The 'dlmtree' function accommodates various response variable types, including continuous, binary, and zero-inflated count values.
The function is designed to handle both single exposure and exposure mixtures. For a single exposure, users are offered options to model non-linear effects (tdlnm),
linear effects (tdlm), or heterogeneous subgroup/individualized effects (hdlm). In the case of exposure mixtures, the function supports
lagged interactions (tdlmm), and heterogeneous subgroup/individualized effects (hdlmm) allowing for a comprehensive exploration of mixture exposure heterogeneity.
Additionally, users can fine-tune parameters to impose effect shrinkage and perform exposure selection, enhancing the adaptability and precision of the modeling process.
For more detailed documentation, visit: <a href="https://danielmork.github.io/dlmtree/">dlmtree website</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dlmtree</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">exposure.data</span>,</span>
<span>  dlm.type <span class="op">=</span> <span class="st">"linear"</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  mixture <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  het <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n.trees <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  n.burn <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  n.iter <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  n.thin <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  shrinkage <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  dlmtree.params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  dlmtree.step.prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>  binomial.size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  formula.zi <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tdlnm.exposure.splits <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  tdlnm.time.split.prob <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tdlnm.exposure.se <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  hdlm.modifiers <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  hdlm.modifier.splits <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  hdlm.modtree.params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  hdlm.modtree.step.prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>  hdlm.dlmtree.type <span class="op">=</span> <span class="st">"shared"</span>,</span>
<span>  hdlm.selection.prior <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  mixture.interactions <span class="op">=</span> <span class="st">"noself"</span>,</span>
<span>  mixture.prior <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  monotone.gamma0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  monotone.sigma <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  monotone.tree.time.params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  monotone.tree.exp.params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  monotone.time.kappa <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lowmem <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  save.data <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  diagnostics <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  initial.params <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>object of class formula, a symbolic description of the fixed
effect model to be fitted, e.g. y ~ a + b.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>data frame containing variables used in the formula.</p></dd>


<dt id="arg-exposure-data">exposure.data<a class="anchor" aria-label="anchor" href="#arg-exposure-data"></a></dt>
<dd><p>numerical matrix of exposure data with same length as data, for a mixture setting (tdlmm, hdlmm):
named list containing equally sized numerical matrices of exposure data having same length as data.</p></dd>


<dt id="arg-dlm-type">dlm.type<a class="anchor" aria-label="anchor" href="#arg-dlm-type"></a></dt>
<dd><p>dlm model specification: "linear" (default), "nonlinear", "monotone".</p></dd>


<dt id="arg-family">family<a class="anchor" aria-label="anchor" href="#arg-family"></a></dt>
<dd><p>'gaussian' for continuous response, 'logit' for binomial, 'zinb' for zero-inflated negative binomial.</p></dd>


<dt id="arg-mixture">mixture<a class="anchor" aria-label="anchor" href="#arg-mixture"></a></dt>
<dd><p>flag for mixture, set to TRUE for tdlmm and hdlmm. (default: FALSE)</p></dd>


<dt id="arg-het">het<a class="anchor" aria-label="anchor" href="#arg-het"></a></dt>
<dd><p>flag for heterogeneity, set to TRUE for hdlm and hdlmm. (default: FALSE)</p></dd>


<dt id="arg-n-trees">n.trees<a class="anchor" aria-label="anchor" href="#arg-n-trees"></a></dt>
<dd><p>integer for number of trees in ensemble.</p></dd>


<dt id="arg-n-burn">n.burn<a class="anchor" aria-label="anchor" href="#arg-n-burn"></a></dt>
<dd><p>integer for length of MCMC burn-in.</p></dd>


<dt id="arg-n-iter">n.iter<a class="anchor" aria-label="anchor" href="#arg-n-iter"></a></dt>
<dd><p>integer for number of MCMC iterations to run model after burn-in.</p></dd>


<dt id="arg-n-thin">n.thin<a class="anchor" aria-label="anchor" href="#arg-n-thin"></a></dt>
<dd><p>integer MCMC thinning factor, i.e. keep every tenth iteration.</p></dd>


<dt id="arg-shrinkage">shrinkage<a class="anchor" aria-label="anchor" href="#arg-shrinkage"></a></dt>
<dd><p>character "all" (default), "trees", "exposures", "none",
turns on horseshoe-like shrinkage priors for different parts of model.</p></dd>


<dt id="arg-dlmtree-params">dlmtree.params<a class="anchor" aria-label="anchor" href="#arg-dlmtree-params"></a></dt>
<dd><p>numerical vector of alpha and beta hyperparameters
controlling dlm tree depth. (default: alpha = 0.95, beta = 2)</p></dd>


<dt id="arg-dlmtree-step-prob">dlmtree.step.prob<a class="anchor" aria-label="anchor" href="#arg-dlmtree-step-prob"></a></dt>
<dd><p>numerical vector for probability of each step for dlm tree updates: 1) grow/prune,
2) change, 3) switch exposure. (default: c(0.25, 0.25, 0.25))</p></dd>


<dt id="arg-binomial-size">binomial.size<a class="anchor" aria-label="anchor" href="#arg-binomial-size"></a></dt>
<dd><p>integer type scalar (if all equal, default: 1) or
vector defining binomial size for 'logit' family.</p></dd>


<dt id="arg-formula-zi">formula.zi<a class="anchor" aria-label="anchor" href="#arg-formula-zi"></a></dt>
<dd><p>(only applies to family = 'zinb') object of class formula, a symbolic description of the fixed effect of
zero-inflated (ZI) model to be fitted, e.g. y ~ a + b. This only applies to ZINB where covariates for
ZI model are different from NB model. This is set to the argument 'formula' by default.</p></dd>


<dt id="arg-tdlnm-exposure-splits">tdlnm.exposure.splits<a class="anchor" aria-label="anchor" href="#arg-tdlnm-exposure-splits"></a></dt>
<dd><p>scalar indicating the number of splits (divided
evenly across quantiles of the exposure data) or list with two components:
'type' = 'values' or 'quantiles', and 'split.vals' = a numerical
vector indicating the corresponding exposure values or quantiles for splits.</p></dd>


<dt id="arg-tdlnm-time-split-prob">tdlnm.time.split.prob<a class="anchor" aria-label="anchor" href="#arg-tdlnm-time-split-prob"></a></dt>
<dd><p>probability vector of a spliting probabilities for time lags. (default: uniform probabilities)</p></dd>


<dt id="arg-tdlnm-exposure-se">tdlnm.exposure.se<a class="anchor" aria-label="anchor" href="#arg-tdlnm-exposure-se"></a></dt>
<dd><p>numerical matrix of exposure standard errors with same
size as exposure.data or a scalar smoothing factor representing a uniform
smoothing factor applied to each exposure measurement. (default: sd(exposure.data)/2)</p></dd>


<dt id="arg-hdlm-modifiers">hdlm.modifiers<a class="anchor" aria-label="anchor" href="#arg-hdlm-modifiers"></a></dt>
<dd><p>string vector containing desired modifiers to be included in a modifier tree.
The strings in the vector must match the names of the columns of the data.
By default, a modifier tree considers all covariates in the formula as modifiers unless stated otherwise.</p></dd>


<dt id="arg-hdlm-modifier-splits">hdlm.modifier.splits<a class="anchor" aria-label="anchor" href="#arg-hdlm-modifier-splits"></a></dt>
<dd><p>integer value to determine the possible number of splitting points that will be used for a modifier tree.</p></dd>


<dt id="arg-hdlm-modtree-params">hdlm.modtree.params<a class="anchor" aria-label="anchor" href="#arg-hdlm-modtree-params"></a></dt>
<dd><p>numerical vector of alpha and beta hyperparameters
controlling modifier tree depth. (default: alpha = 0.95, beta = 2)</p></dd>


<dt id="arg-hdlm-modtree-step-prob">hdlm.modtree.step.prob<a class="anchor" aria-label="anchor" href="#arg-hdlm-modtree-step-prob"></a></dt>
<dd><p>numerical vector for probability of each step for modifier tree updates: 1) grow, 2) prune,
3) change. (default: c(0.25, 0.25, 0.25))</p></dd>


<dt id="arg-hdlm-dlmtree-type">hdlm.dlmtree.type<a class="anchor" aria-label="anchor" href="#arg-hdlm-dlmtree-type"></a></dt>
<dd><p>specification of dlmtree type for HDLM: shared (default) or nested.</p></dd>


<dt id="arg-hdlm-selection-prior">hdlm.selection.prior<a class="anchor" aria-label="anchor" href="#arg-hdlm-selection-prior"></a></dt>
<dd><p>scalar hyperparameter for sparsity of modifiers. Must be between 0.5 and 1.
Smaller value corresponds to increased sparsity of modifiers.</p></dd>


<dt id="arg-mixture-interactions">mixture.interactions<a class="anchor" aria-label="anchor" href="#arg-mixture-interactions"></a></dt>
<dd><p>'noself' (default) which estimates interactions only between two
different exposures, 'all' which also allows interactions within the same exposure, or 'none'
which eliminates all interactions and estimates only main effects of each exposure.</p></dd>


<dt id="arg-mixture-prior">mixture.prior<a class="anchor" aria-label="anchor" href="#arg-mixture-prior"></a></dt>
<dd><p>positive scalar hyperparameter for sparsity of exposures. (default: 1)</p></dd>


<dt id="arg-monotone-gamma-">monotone.gamma0<a class="anchor" aria-label="anchor" href="#arg-monotone-gamma-"></a></dt>
<dd><p>vector (with length equal to number of lags) of means for logit-transformed prior probability of split at each lag;
e.g., gamma_0l = 0 implies mean prior probability of split at lag l = 0.5.</p></dd>


<dt id="arg-monotone-sigma">monotone.sigma<a class="anchor" aria-label="anchor" href="#arg-monotone-sigma"></a></dt>
<dd><p>symmetric matrix (usually with only diagonal elements) corresponding to gamma_0 to define variances on prior probability of split;
e.g., gamma_0l = 0 with lth diagonal element of sigma=2.701 implies that 95% of the time the prior probability of split is between 0.005 and 0.995,
as a second example setting gamma_0l=4.119 and the corresponding diagonal element of sigma=0.599 implies that 95% of the time the prior probability of a split is between 0.8 and 0.99.</p></dd>


<dt id="arg-monotone-tree-time-params">monotone.tree.time.params<a class="anchor" aria-label="anchor" href="#arg-monotone-tree-time-params"></a></dt>
<dd><p>numerical vector of hyperparameters for monotone time tree.</p></dd>


<dt id="arg-monotone-tree-exp-params">monotone.tree.exp.params<a class="anchor" aria-label="anchor" href="#arg-monotone-tree-exp-params"></a></dt>
<dd><p>numerical vector of hyperparameters for monotone exposure tree.</p></dd>


<dt id="arg-monotone-time-kappa">monotone.time.kappa<a class="anchor" aria-label="anchor" href="#arg-monotone-time-kappa"></a></dt>
<dd><p>scaling factor in dirichlet prior that goes alongside <code>tdlnm.time.split.prob</code> to
control the amount of prior information given to the model for deciding probabilities of splits between adjacent lags.</p></dd>


<dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>integer vector to analyze only a subset of data and exposures.</p></dd>


<dt id="arg-lowmem">lowmem<a class="anchor" aria-label="anchor" href="#arg-lowmem"></a></dt>
<dd><p>TRUE or FALSE (default): turn on memory saver for DLNM, slower computation time.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>TRUE (default) or FALSE: print output</p></dd>


<dt id="arg-save-data">save.data<a class="anchor" aria-label="anchor" href="#arg-save-data"></a></dt>
<dd><p>TRUE (default) or FALSE: save data used for model fitting. This must be set to TRUE to use shiny() function on hdlm or hdlmm</p></dd>


<dt id="arg-diagnostics">diagnostics<a class="anchor" aria-label="anchor" href="#arg-diagnostics"></a></dt>
<dd><p>TRUE or FALSE (default) keep model diagnostic such as the number of
terminal nodes and acceptance ratio.</p></dd>


<dt id="arg-initial-params">initial.params<a class="anchor" aria-label="anchor" href="#arg-initial-params"></a></dt>
<dd><p>initial parameters for fixed effects model, FALSE = none (default),
"glm" = generate using GLM, or user defined, length must equal number of parameters in fixed effects model.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Object of one of the classes: tdlm, tdlmm, tdlnm, hdlm, hdlmm</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>dlmtree</p>
<p>Model is recommended to be run for at minimum 5000 burn-in
iterations followed by 15000 sampling iterations with a thinning factor of 5.
Convergence can be checked by re-running the model and validating consistency
of results. Examples are provided below for the syntax for running different types of models.
For more examples, visit: <a href="https://danielmork.github.io/dlmtree/">dlmtree website</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># The first three examples are for one lagged exposure</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># treed distributed lag model (TDLM)</span></span></span>
<span class="r-in"><span>  <span class="co"># binary outcome with logit link</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim.tdlmm.html">sim.tdlmm</a></span><span class="op">(</span>sim <span class="op">=</span> <span class="st">"A"</span>, mean.p <span class="op">=</span> <span class="fl">0.5</span>, n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">tdlm.fit</span> <span class="op">&lt;-</span> <span class="fu">dlmtree</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>,</span></span>
<span class="r-in"><span>                      data <span class="op">=</span> <span class="va">D</span><span class="op">$</span><span class="va">dat</span>,</span></span>
<span class="r-in"><span>                      exposure.data <span class="op">=</span> <span class="va">D</span><span class="op">$</span><span class="va">exposures</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                      dlm.type <span class="op">=</span> <span class="st">"linear"</span>,</span></span>
<span class="r-in"><span>                      family <span class="op">=</span> <span class="st">"logit"</span>,</span></span>
<span class="r-in"><span>                      binomial.size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Preparing data...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Running TDLM:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Burn-in % complete </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [0--------25--------50--------75--------100]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ''''''''''''''''''''''''''''''''''''''''''</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MCMC iterations (est time: 2 seconds)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [0--------25--------50--------75--------100]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ''''''''''''''''''''''''''''''''''''''''''</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Compiling results...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># summarize results</span></span></span>
<span class="r-in"><span>  <span class="va">tdlm.sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">tdlm.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">tdlm.sum</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> TDLM summary</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model run info:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - y ~ . </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - sample size: 1,000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - family: logit </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 20 trees</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 1000 burn-in iterations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 2000 post-burn iterations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 2 thinning factor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 0.95 confidence level</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed effect coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Mean  Lower  Upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) -0.211 -0.547  0.130</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c1           0.078 -0.050  0.202</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c2           0.088 -0.042  0.213</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c3          -0.129 -0.250  0.003</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c4           0.060 -0.070  0.189</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c5         -0.154 -0.282 -0.032</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1          -0.022 -0.270  0.218</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2          -0.052 -0.335  0.219</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b3           0.053 -0.196  0.300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b4           0.103 -0.160  0.381</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b5          0.336  0.047  0.598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * = CI does not contain zero</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DLM effect:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> range = [-0.025, 0.093]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> signal-to-noise = 0.231</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> critical windows: 20-27 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Mean  Lower Upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 1   -0.014 -0.086 0.062</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 2   -0.020 -0.096 0.035</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 3   -0.025 -0.130 0.026</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 4    0.001 -0.049 0.062</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 5    0.010 -0.032 0.077</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 6    0.008 -0.032 0.056</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 7    0.011 -0.025 0.057</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 8    0.010 -0.026 0.055</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 9    0.010 -0.028 0.061</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 10   0.006 -0.035 0.059</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 11  -0.001 -0.051 0.042</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 12  -0.007 -0.060 0.030</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 13  -0.006 -0.061 0.030</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 14   0.001 -0.050 0.045</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 15   0.005 -0.045 0.048</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 16   0.013 -0.028 0.057</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 17   0.020 -0.023 0.068</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 18   0.025 -0.022 0.074</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 19   0.036 -0.025 0.095</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *Period 20  0.061  0.005 0.119</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *Period 21  0.075  0.020 0.123</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *Period 22  0.078  0.016 0.127</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *Period 23  0.091  0.047 0.155</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *Period 24  0.093  0.048 0.157</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *Period 25  0.089  0.044 0.140</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *Period 26  0.084  0.034 0.139</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *Period 27  0.084  0.025 0.172</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 28   0.054 -0.013 0.122</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 29   0.035 -0.024 0.088</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 30   0.032 -0.017 0.075</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 31   0.033 -0.015 0.078</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 32   0.031 -0.019 0.075</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 33   0.034 -0.011 0.084</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 34   0.036 -0.012 0.099</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 35   0.033 -0.021 0.102</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 36   0.003 -0.090 0.063</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Period 37  -0.010 -0.105 0.055</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * = CI does not contain zero</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># plot results</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tdlm.sum</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="dlmtree-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Treed distributed lag nonlinear model (TDLNM)</span></span></span>
<span class="r-in"><span>  <span class="co"># Gaussian regression model</span></span></span>
<span class="r-in"><span>  <span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim.tdlnm.html">sim.tdlnm</a></span><span class="op">(</span>sim <span class="op">=</span> <span class="st">"A"</span>, error.to.signal <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">tdlnm.fit</span> <span class="op">&lt;-</span> <span class="fu">dlmtree</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">.</span>,</span></span>
<span class="r-in"><span>                       data <span class="op">=</span> <span class="va">D</span><span class="op">$</span><span class="va">dat</span>,</span></span>
<span class="r-in"><span>                       exposure.data <span class="op">=</span> <span class="va">D</span><span class="op">$</span><span class="va">exposures</span>,</span></span>
<span class="r-in"><span>                       dlm.type <span class="op">=</span> <span class="st">"nonlinear"</span>,</span></span>
<span class="r-in"><span>                       family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Preparing data...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Running TDLNM:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Burn-in % complete </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [0--------25--------50--------75--------100]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ''''''''''''''''''''''''''''''''''''''''''</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MCMC iterations (est time: 2 seconds)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [0--------25--------50--------75--------100]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ''''''''''''''''''''''''''''''''''''''''''</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Compiling results...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># summarize results</span></span></span>
<span class="r-in"><span>  <span class="va">tdlnm.sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">tdlnm.fit</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Centered DLNM at exposure value 0 </span>
<span class="r-in"><span>  <span class="va">tdlnm.sum</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> TDLNM summary</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model run info:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - y ~ . </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - sample size: 926 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - family: gaussian </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 20 trees</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 1000 burn-in iterations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 2000 post-burn iterations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 2 thinning factor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 0.95 confidence level</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed effect coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Mean   Lower  Upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) -3.401 -13.502  7.062</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c1          0.907   0.797  1.006</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c2         -0.187  -0.299 -0.085</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c3          0.458   0.334  0.570</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c4          0.689   0.576  0.799</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c5         -1.406  -1.512 -1.293</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b1          1.453   1.252  1.666</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b2         -0.786  -1.009 -0.572</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b3         -0.639  -0.858 -0.421</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b4         -1.543  -1.759 -1.322</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b5          0.837   0.628  1.058</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * = CI does not contain zero</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DLNM effect:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> range = [-1.203, 0.217]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> signal-to-noise = 0.849</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> critical windows: 3-15,18-24 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> residual standard errors: 0.138 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># plot results</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tdlnm.sum</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="dlmtree-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Heterogenious TDLM (HDLM), similar to first example but with heterogenious exposure response</span></span></span>
<span class="r-in"><span>  <span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim.hdlmm.html">sim.hdlmm</a></span><span class="op">(</span>sim <span class="op">=</span> <span class="st">"B"</span>, n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">hdlm.fit</span> <span class="op">&lt;-</span> <span class="fu">dlmtree</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>,</span></span>
<span class="r-in"><span>                      data <span class="op">=</span> <span class="va">D</span><span class="op">$</span><span class="va">dat</span>,</span></span>
<span class="r-in"><span>                      exposure.data <span class="op">=</span> <span class="va">D</span><span class="op">$</span><span class="va">exposures</span>,</span></span>
<span class="r-in"><span>                      dlm.type <span class="op">=</span> <span class="st">"linear"</span>,</span></span>
<span class="r-in"><span>                      family <span class="op">=</span> <span class="st">"gaussian"</span>,</span></span>
<span class="r-in"><span>                      het <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Preparing data...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Running shared HDLM:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Burn-in % complete </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [0--------25--------50--------75--------100]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ''''''''''''''''''''''''''''''''''''''''''</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MCMC iterations (est time: 4 seconds)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [0--------25--------50--------75--------100]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ''''''''''''''''''''''''''''''''''''''''''</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Compiling results...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># summarize results</span></span></span>
<span class="r-in"><span>  <span class="va">hdlm.sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">hdlm.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">hdlm.sum</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HDLM summary</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model run info:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - y ~ . </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - sample size: 1,000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - family: gaussian </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 20 trees</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 1000 burn-in iterations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 2000 post-burn iterations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 2 thinning factor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 0.5 modifier sparsity prior</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 0.95 confidence level</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Mean  Lower  Upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  (Intercept)  0.066 -0.125  0.265</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *mod_num     -0.770 -0.829 -0.709</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *mod_bin     -0.907 -1.038 -0.780</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *mod_scale   -0.816 -1.037 -0.603</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c1          -1.769 -1.837 -1.705</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c2          -0.326 -0.390 -0.262</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c3          -0.376 -0.437 -0.317</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c4           0.448  0.390  0.507</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c5          -0.844 -0.911 -0.782</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b1          -1.656 -1.779 -1.532</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b2          -0.217 -0.338 -0.101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b3           1.359  1.229  1.488</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b4           1.043  0.918  1.167</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  b5          -0.025 -0.144  0.092</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * = CI does not contain zero</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Modifiers:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             PIP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mod_num   1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mod_bin   0.198</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mod_scale 1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c1        0.192</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c2        0.231</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c3        0.204</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c4        0.193</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c5        0.300</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1        0.220</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2        0.170</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b3        0.234</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b4        0.277</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b5        0.344</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PIP = Posterior inclusion probability</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> residual standard errors: 0.045</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> To obtain exposure effect estimates, use the 'shiny(fit)' function.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># shiny app for HDLM</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="shiny.html">shiny</a></span><span class="op">(</span><span class="va">hdlm.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># The next two examples are for a mixture (or multivariate) exposure</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Treed distributed lag mixture model (TDLMM)</span></span></span>
<span class="r-in"><span>  <span class="co"># Model for mixutre (or multivariate) lagged exposures</span></span></span>
<span class="r-in"><span>  <span class="co"># with a homogenious exposure-time-response function</span></span></span>
<span class="r-in"><span>  <span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim.tdlmm.html">sim.tdlmm</a></span><span class="op">(</span>sim <span class="op">=</span> <span class="st">"B"</span>, error <span class="op">=</span> <span class="fl">25</span>, n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">tdlmm.fit</span> <span class="op">&lt;-</span> <span class="fu">dlmtree</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>,</span></span>
<span class="r-in"><span>                       data <span class="op">=</span> <span class="va">D</span><span class="op">$</span><span class="va">dat</span>, exposure.data <span class="op">=</span> <span class="va">D</span><span class="op">$</span><span class="va">exposures</span>,</span></span>
<span class="r-in"><span>                       mixture.interactions <span class="op">=</span> <span class="st">"noself"</span>,</span></span>
<span class="r-in"><span>                       dlm.type <span class="op">=</span> <span class="st">"linear"</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>,</span></span>
<span class="r-in"><span>                       mixture <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Preparing data...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Running TDLMM:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Burn-in % complete </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [0--------25--------50--------75--------100]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ''''''''''''''''''''''''''''''''''''''''''</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MCMC iterations (est time: 4 seconds)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [0--------25--------50--------75--------100]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ''''''''''''''''''''''''''''''''''''''''''</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Compiling results...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># summarize results</span></span></span>
<span class="r-in"><span>  <span class="va">tdlmm.sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">tdlmm.fit</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Specified co-exposure values:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - e1 : 4.210665</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - e2 : 4.521686</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - e3 : 4.542955</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - e4 : 4.16903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - e5 : 5.989966</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Reconstructing main effects...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Reconstructing interaction effects...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0%...25%...50%...75%...100%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calculating marginal effects...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calculating fixed effects...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># plot the marginal exposure-response for one exposure</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tdlmm.sum</span>, exposure1 <span class="op">=</span> <span class="st">"e1"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="dlmtree-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># plot exposure-response surface</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tdlmm.sum</span>, exposure1 <span class="op">=</span> <span class="st">"e1"</span>, exposure2 <span class="op">=</span> <span class="st">"e2"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="dlmtree-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># heterogenious version of TDLMM</span></span></span>
<span class="r-in"><span>  <span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim.hdlmm.html">sim.hdlmm</a></span><span class="op">(</span>sim <span class="op">=</span> <span class="st">"D"</span>, n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">hdlmm.fit</span> <span class="op">&lt;-</span> <span class="fu">dlmtree</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>,</span></span>
<span class="r-in"><span>                       data <span class="op">=</span> <span class="va">D</span><span class="op">$</span><span class="va">dat</span>,</span></span>
<span class="r-in"><span>                       exposure.data <span class="op">=</span> <span class="va">D</span><span class="op">$</span><span class="va">exposures</span>,</span></span>
<span class="r-in"><span>                       dlm.type <span class="op">=</span> <span class="st">"linear"</span>,</span></span>
<span class="r-in"><span>                       family <span class="op">=</span> <span class="st">"gaussian"</span>,</span></span>
<span class="r-in"><span>                       mixture <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                       het <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Preparing data...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Running HDLMM:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Burn-in % complete </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [0--------25--------50--------75--------100]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ''''''''''''''''''''''''''''''''''''''''''</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MCMC iterations (est time: 18 seconds)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [0--------25--------50--------75--------100]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ''''''''''''''''''''''''''''''''''''''''''</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Compiling results...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># summarize results</span></span></span>
<span class="r-in"><span>  <span class="va">hdlmm.sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">hdlmm.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">hdlmm.sum</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> HDLMM summary</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model run info:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - y ~ . </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - family: gaussian </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 20 trees</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 1000 burn-in iterations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 2000 post-burn iterations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 2 thinning factor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 3 exposures measured at 37 time points</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 3 two-way interactions (no-self interactions)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 0.5 modifier sparsity prior</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 1 exposure sparsity prior</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - 0.95 confidence level</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Mean  Lower  Upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  (Intercept)  0.082 -0.183  0.356</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *mod_num     -0.524 -0.621 -0.424</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *mod_bin      0.613  0.428  0.805</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  mod_scale    0.162 -0.087  0.413</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c1          -0.951 -1.017 -0.883</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c2          -0.354 -0.423 -0.291</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c3          -0.981 -1.047 -0.913</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  c4           0.025 -0.042  0.095</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *c5          -0.376 -0.455 -0.307</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b1          -0.821 -0.957 -0.674</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b2           0.210  0.056  0.351</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b3          -1.716 -1.859 -1.571</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b4           0.395  0.252  0.532</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> *b5           0.409  0.265  0.548</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> * = CI does not contain zero</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Modifiers:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             PIP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mod_num   1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mod_bin   1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mod_scale 0.578</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c1        0.597</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c2        0.664</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c3        0.621</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c4        0.583</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c5        0.619</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b1        0.656</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b2        0.544</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b3        0.540</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b4        0.650</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b5        0.653</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PIP = Posterior inclusion probability</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> residual standard errors: 0.151</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> To obtain exposure effect estimates, use the 'shiny(fit)' function.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># summarize results</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="shiny.html">shiny</a></span><span class="op">(</span><span class="va">hdlmm.fit</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Mork, Seongwon Im, Ander Wilson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

