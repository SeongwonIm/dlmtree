---
title: "TDLNM"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{TDLNM}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette demonstrates the implementation of treed distributed lag non-linear model (TDLNM). More details can be found in Mork and Wilson (2021) <doi: [10.1093/biostatistics/kxaa051](https://doi.org/10.1093/biostatistics/kxaa051)>.

```{r setup}
library(dlmtree)
set.seed(1)
```

### Fitting the model
```{r tdlnm.fit}
D <- sim.tdlnm(sim = "A", error.to.signal = 1)
fit <- dlmtree(formula = y ~ .,
               data = D$dat,
               exposure.data = D$exposures,
               dlm.type = "nonlinear", 
               family = "gaussian",
               n.burn = 2500, n.iter = 10000, n.thin = 5)
```

### Model fit summary
```{r tdlnm.sum}
fit_sum <- summary(fit)
fit_sum
```

### Exposure-time surface
```{r tdlnm.plot}
plot(fit_sum, 
     main = "Plot title", 
     xlab = "Time axis label", 
     ylab = "Exposure-concentration axis label", 
     flab = "Effect color label")
```
